{% extends 'base.html' %}
{% load bootstrap5 %}

{% block content %}
    {% if user.is_superuser %}
        <!-- Header Section -->
        <div class="hero-section" style="padding: 2rem 0; margin-top: 4rem;">
            <div class="container hero-content text-center">
                <div class="icon-feature mx-auto mb-3">
                    <i class="fas fa-paper-plane fa-lg"></i>
                </div>
                <h2 class="fw-bold mb-2" style="font-family: 'Noto Sans KR', sans-serif;">메시지 전송</h2>
                <p class="lead mb-0">환자에게 중요한 알림 메시지를 전송하세요</p>
            </div>
        </div>

        <div class="container my-5" style="max-width: 800px; padding: 0 2rem;">
            <div class="row justify-content-center">
                <div class="col-lg-10">
                    <div class="card-modern" style="padding: 2rem;">
                        <div class="text-center mb-5">
                            <div class="icon-feature mx-auto mb-4" style="background: linear-gradient(135deg, #10b981 0%, #047857 100%);">
                                <i class="fas fa-edit fa-lg"></i>
                            </div>
                            <h3 class="section-title text-center">메시지 작성</h3>
                            <p class="text-muted" style="font-size: 1.1rem;">환자 ID와 전달할 메시지를 입력해 주세요</p>
                        </div>
                        
                        <!-- Message Form -->
                        <form method="post" action="{% url 'noteapp:send_notes' %}" class="message-form">
                            {% csrf_token %}
                            
                            <div class="alert-modern" style="border-left-color: #3b82f6; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 2rem; margin-bottom: 2rem;">
                                <div class="mb-4">
                                    <label for="recipient_id" class="form-label fw-bold text-primary mb-3">
                                        <i class="fas fa-user me-2"></i>수신자 ID
                                    </label>
                                    <input type="number" 
                                           name="recipient_id" 
                                           id="recipient_id" 
                                           class="form-control form-control-lg" 
                                           placeholder="환자 ID를 입력하세요"
                                           required
                                           style="border-radius: 12px; border: 2px solid #e5e7eb; padding: 1rem;">
                                    <div class="form-text text-primary mt-2">
                                        <i class="fas fa-info-circle me-1"></i>환자의 고유 ID 번호를 입력해 주세요
                                    </div>
                                </div>
                            </div>
                            
                            <div class="alert-modern" style="border-left-color: #10b981; background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 2rem; margin-bottom: 2rem;">
                                <div class="mb-4">
                                    <label for="message" class="form-label fw-bold text-success mb-3">
                                        <i class="fas fa-comment me-2"></i>메시지 내용
                                    </label>
                                    <textarea name="message" 
                                              id="message" 
                                              class="form-control" 
                                              rows="4" 
                                              placeholder="전송할 메시지를 입력하세요..."
                                              required
                                              style="border-radius: 12px; border: 2px solid #e5e7eb; padding: 1rem; resize: vertical; min-height: 120px;"></textarea>
                                    <div class="form-text text-success mt-2">
                                        <i class="fas fa-info-circle me-1"></i>명확하고 정중한 메시지를 작성해 주세요
                                    </div>
                                </div>
                            </div>
                            
                            <div class="text-center mb-4">
                                <button type="submit" class="btn-modern btn-lg">
                                    <i class="fas fa-paper-plane me-2"></i>메시지 전송하기
                                </button>
                            </div>
                        </form>
                        
                        <!-- Quick Templates -->
                        <div class="alert-modern" style="border-left-color: #8b5cf6; background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%); padding: 2rem;">
                            <h5 class="fw-bold mb-4" style="color: #8b5cf6;">
                                <i class="fas fa-clipboard-list me-2"></i>자주 사용하는 메시지 템플릿
                            </h5>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <div class="template-card" style="background: rgba(255, 255, 255, 0.7); padding: 1rem; border-radius: 8px; cursor: pointer;" onclick="setMessage(this)" data-message="오늘 예약한 진료가 있는 날입니다. 예약시간에 맞추어 내원해 주세요.">
                                        <div class="d-flex align-items-start">
                                            <i class="fas fa-calendar-check text-success me-2 mt-1"></i>
                                            <div>
                                                <strong style="color: #7c3aed;">진료 예약 안내</strong><br>
                                                <small class="text-muted">오늘 예약한 진료가 있는 날입니다...</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <div class="template-card" style="background: rgba(255, 255, 255, 0.7); padding: 1rem; border-radius: 8px; cursor: pointer;" onclick="setMessage(this)" data-message="병원에서 먼저 동일시간에 예약하신 분이 계셔서 승인을 해 드릴 수가 없습니다. 다른 시간으로 예약해 주시면 감사하겠습니다.">
                                        <div class="d-flex align-items-start">
                                            <i class="fas fa-exclamation-triangle text-warning me-2 mt-1"></i>
                                            <div>
                                                <strong style="color: #7c3aed;">예약 충돌 안내</strong><br>
                                                <small class="text-muted">동일시간에 예약하신 분이 계셔서...</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <div class="template-card" style="background: rgba(255, 255, 255, 0.7); padding: 1rem; border-radius: 8px; cursor: pointer;" onclick="setMessage(this)" data-message="오늘 진료가 있는 날인데 못 오셨군요. 다음에는 미리 예약을 취소해 주시길 바랍니다.">
                                        <div class="d-flex align-items-start">
                                            <i class="fas fa-user-times text-danger me-2 mt-1"></i>
                                            <div>
                                                <strong style="color: #7c3aed;">미내원 안내</strong><br>
                                                <small class="text-muted">오늘 진료가 있는 날인데...</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <div class="template-card" style="background: rgba(255, 255, 255, 0.7); padding: 1rem; border-radius: 8px; cursor: pointer;" onclick="setMessage(this)" data-message="예약 시간에 너무 임박해서 취소하셨군요. 가능하면 하루 전에, 늦어도 2시간 전에는 취소해 주시길 당부드립니다.">
                                        <div class="d-flex align-items-start">
                                            <i class="fas fa-clock text-info me-2 mt-1"></i>
                                            <div>
                                                <strong style="color: #7c3aed;">취소 시간 안내</strong><br>
                                                <small class="text-muted">예약 시간에 너무 임박해서...</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-3">
                                <small class="text-muted">
                                    <i class="fas fa-info-circle me-1"></i>템플릿을 클릭하면 메시지 내용이 자동으로 입력됩니다
                                </small>
                            </div>
                        </div>
                        
                        <!-- Navigation -->
                        <div class="text-center mt-4">
                            <a href="{% url 'noteapp:notes_history' %}" class="btn btn-outline-primary rounded-pill">
                                <i class="fas fa-history me-2"></i>발송 기록 보기
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <style>
            .message-form .form-control:focus {
                border-color: #3b82f6;
                box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25);
            }
            
            .template-card {
                transition: all 0.2s ease;
                border: 2px solid transparent;
            }
            
            .template-card:hover {
                transform: translateY(-2px);
                border-color: #8b5cf6;
                box-shadow: 0 4px 6px rgba(139, 92, 246, 0.15);
            }
            
            .template-card:active {
                transform: translateY(0);
                background: rgba(139, 92, 246, 0.1) !important;
            }
            
            @media (max-width: 768px) {
                .hero-section h2 {
                    font-size: 1.5rem;
                }
                
                .hero-section .lead {
                    font-size: 1rem;
                }
                
                .card-modern {
                    padding: 1.5rem !important;
                }
                
                .template-card {
                    margin-bottom: 0.5rem;
                }
            }
        </style>

        <script>
            function setMessage(element) {
                const message = element.getAttribute('data-message');
                const messageTextarea = document.getElementById('message');
                messageTextarea.value = message;
                messageTextarea.focus();
                
                // Add visual feedback
                element.style.background = 'rgba(139, 92, 246, 0.2)';
                setTimeout(() => {
                    element.style.background = 'rgba(255, 255, 255, 0.7)';
                }, 200);
            }
        </script>
    {% endif %}
{% endblock %}
